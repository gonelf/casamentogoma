<!DOCTYPE HTML>
<html lang="pt" dir="ltr">
<head>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

  <script src="./cookie.js"></script>
  <script src="./airtable.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <title>Go•Ma - Mariana & Gonçalo</title>
  <meta name="description" content="Go•Ma - Mariana & Gonçalo">
  <meta name="author" content="GoMa Studios">
  <link rel="stylesheet" href="general.css">
  <link rel="stylesheet" href="main.css">
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bellota+Text">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="animations.js"></script>
  <script src="progress-bar.js"></script>
</head>
  <body>
    <div class="wrapper">

      <div class="navbar" id="menu-normal">
        <nav id="menu">
          <img src="img/goma-subtract.svg" alt="GoMa">
          <a href="#top" id="#presenca" class="menu-items localize active">[menu_rsvp]</a>
          <a href="#localizacao" id="#localizacao" class="menu-items localize">[menu_location]</a>
          <a href="#faqs" id="#faqs" class="menu-items localize">[menu_faqs]</a>
          <a href="#contactos" id="#contactos" class="menu-items localize">[menu_contacts]</a>
          <a href="gifts.html" id="#gifts" class="menu-items localize" target="_blank">[menu_gifts] <img src="img/new-tab.svg" alt="Opens in a new tab"></a>
          <a href="index.html" class="logout localize">[menu_logout]</a>

          <div class="menu-lang">
            <a href="?lang=pt" class="menu-items">PT</a>
            <a href="?lang=en" class="menu-items">EN</a>
          </div>

          <p class="signature">Made with ♥ by GoMa, 2023.</p>
        </nav>
      </div>

      <div class="navbar" id="mobile-menu" style="display:none;">
        <nav id="menu">

          <a href="#" class="close-icon"><img src="img/close.svg" alt="Close"></a>

          <a href="#top" id="#presenca" class="menu-items localize active">[menu_rsvp]</a>
          <a href="#localizacao" id="#localizacao" class="menu-items localize">[menu_location]</a>
          <a href="#faqs" id="#faqs" class="menu-items localize">[menu_faqs]</a>
          <a href="#contactos" id="#contactos" class="menu-items localize">[menu_contacts]</a>
          <a href="gifts.html" id="#gifts" class="menu-items localize" target="_blank">[menu_gifts] <img src="img/new-tab.svg" alt="Opens in a new tab"></a>
          <a href="index.html" class="logout localize">[menu_logout]</a>

          <div class="menu-lang">
            <a href="?lang=pt" class="menu-items">PT</a>
            <a href="?lang=en" class="menu-items">EN</a>
          </div>

          <p class="signature">Made with ♥ by GoMa, 2023.</p>
        </nav>
      </div>

      <h2 class="hello localize" id="welcome">[HI], [FirstName].</h2>
      <a id="menu-mobile-button" style="cursor:pointer">
        <img src="img/menu-icon.svg" alt="Menu">
        Menu
      </a>


      <section id="gifts_container" class="container">
          <script type="text/javascript">
            getGifts(function(data){
              // console.log(data.records);
              var gifts = "";
              data.records.forEach((entry, i) => {
                var gift = entry.fields;
                // console.log(typeof gift.contributors);
                var contributors = (gift.contributors !== undefined) ? gift.contributors.join(", ") : [];
                let unique = [...new Set(gift.contributors)];
                let contributions = 0;
                // console.log(gift.contributions);
                (gift.contributions) ? gift.contributions.map(x => contributions += x) : 0;
                let percent = Math.round(contributions*100/gift.value);
                var g = `
                <div id="${entry.id}" style="display:flex; margin-bottom:30px;">
                  <div id="left" >
                    <img src="${gift.images[0].url}" />
                  </div>
                  <div id="right" style="padding-left:20px;">
                    <h1>${gift.title}</h1>
                    <div class="progress-bar">
                      <div class="progress"
                      data-percent="${percent}"
                      data-color="green">
                      <span>${percent}%</span>
                      </div>
                    </div>
                    <h2>Preço: €${gift.value}</h2>
                    <h2>Contribuições: €${contributions}</h2>
                    <span>${unique.join(", ")}</span>
                    <button type="button" name="button" class="contribute" gift_id="${gift.ID}" gifts_id="${entry.id}">Contribuir</button>
                  </div>
                </div>`;
                $("#gifts_container").append(g);
                $(".progress-bar").ProgressBar();
              });
            });

          </script>


        </div>
      </section>



      <div class="modal-overlay" id="modal-overlay">
        <div class="modal-card" id="modal-card">
          <h2 class="modal-title"></h2>
          <a href="#" id="close"><img src="img/close.svg" alt="Fechar"></a>

          <form class="_form_" action="index.html" method="post" id="contribution" name="contribution" style="display:block;">
            <div class="form-container">
              <div class="form-field other-fields">
                <label for="cont_value" class="form-label">Contribuição</label>
                <input type="text" id="amount" name="amount" value="" placeholder="">
              </div>
            </div>
            <div class="button-container">
              <button type="submit" name="contribution" class="btn-gold btn-form">Confirmar</button>
            </div>

            <!-- <input type="hidden" id="id" value="" /> -->
            <input type="hidden" id="user_id" name="user_id" value="" />
            <input type="hidden" id="confirmed" name="confirmed" value="false">
            <input type="hidden" id="gift_id" name="gift_id" value="">
            <input type="hidden" id="gifts" name="gifts" value="">
          </form>

        </div>
      </div>

    </div>

    <script src="./scripts.js"></script>
  </body>
</html>
